url = "/api/updates"
layout = "default"
title = "updates"
==
<?php
use RainLab\Blog\Models\Post;

function onStart()
{
    /*
     * 1) Pull in only the posts tagged with the category slug "updates"
     *    (you can change that slug to whatever yours is).
     */
    $posts = Post::isPublished()
        ->with('categories')
        ->whereHas('categories', function($q) {
            $q->where('slug', 'latest-updates-insights');
        })
        ->orderBy('published_at', 'desc')
        ->get();

    /*
     * 2) Re-shape each model into a simple array of exactly the keys you need.
     */
    $data = $posts->map(function($post) {
        return [
            'id'           => $post->id,
            'title'        => $post->title,
            'slug'         => $post->slug,
            'excerpt'      => $post->excerpt,
            'content_html' => $post->content_html,
            'published_at' => optional($post->published_at)->toDateTimeString(),
            'categories'   => $post->categories->map(function($cat) {
                return [
                    'id'   => $cat->id,
                    'name' => $cat->name,
                    'slug' => $cat->slug,
                ];
            })->values(),
        ];
    });

    /*
     * 3) Return it as bare JSON and stop October from rendering any Twig.
     */
    header('Content-Type: application/json');
    echo $data->toJson();
    exit;
}
?>
==